generator client {
  provider = "prisma-client-js"
  // output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum status {
  PENDING
  APPROVED
  REJECTED
}

enum userStatus {
  ACTIVE
  INACTIVE
}

enum Role {
  superAdmin
  superPrinter
  stationAdmin
  stationRegistrar
  stationPrinter
  developer
}

model user {
  id          String     @id @default(uuid())
  username    String     @unique
  phone       String     @unique
  password    String
  role        String
  stationUser station?   @relation(fields: [stationId], references: [id])
  stationId   String?
  status      userStatus @default(INACTIVE)
  isAdmin     Boolean    @default(false)
  isActive    Boolean    @default(true)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  // Uncomment and adjust the relation below if you have a Station model

  // Orders where this user is the registrar
  registrarOrders order[] @relation("OrderRegistrar")

  // Orders where this user is the printer
  printerOrders order[]      @relation("OrderPrinter")
  Permission    Permission[]
}

model Permission {
  id         String @id @default(uuid())
  user       user   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId     String
  permission String
}

model station {
  id               String   @id @default(uuid())
  code             String   @unique
  afanOromoName    String
  amharicName      String
  stationAdminName String
  stampPhoto       String?
  signPhoto        String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  // Uncomment the following if you want a relation from user to station
  users   user[]
  order   order[]
  citizen citizen[]
}

enum Sex {
  MALE
  FEMALE
  OTHER
}

model citizen {
  id               String   @id @default(uuid())
  registralNo      String   @unique
  profilePhoto     String?
  stationCitizen   station  @relation(fields: [stationId], references: [id])
  stationId        String
  firstName        String
  middleName       String?
  lastName         String
  gender           Sex
  placeOfBirth     String
  dateOfBirth      DateTime
  occupation       String
  phone            String
  emergencyContact String
  relationship     String
  emergencyPhone   String
  isVerified       status   @default(PENDING)
  barcode          String   @unique @db.Char(12)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  order            order[]
}

enum orderType {
  URGENT
  NORMAL
}

model order {
  id               String    @id @default(uuid())
  orderNumber      String    @unique
  citizenId        String
  orderType        orderType
  orderStatus      status    @default(PENDING)
  paymentMethod    String
  paymentReference String
  paymentProof     String?
  amount           Int
  stationId        String
  registrarId      String
  printerId        String?
  isPrinted        status    @default(PENDING)
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  // Relations

  station   station @relation(fields: [stationId], references: [id])
  registrar user    @relation("OrderRegistrar", fields: [registrarId], references: [id])
  printer   user?   @relation("OrderPrinter", fields: [printerId], references: [id])
  citizen   citizen @relation(fields: [citizenId], references: [id])
}
